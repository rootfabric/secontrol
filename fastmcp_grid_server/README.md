# FastMCP сервер для управления гридами Space Engineers

Этот модуль разворачивает сервер MCP (Multi Capability Protocol), построенный на
[fastmcp](https://github.com/jlowin/fastmcp), и предоставляет функции библиотеки
`secontrol` для работы с гридом и устройствами Space Engineers.

## Возможности

- Авторизация по логину и паролю Redis-шлюза Space Engineers.
- Получение списка всех гридов владельца, включая детали `gridinfo`.
- Просмотр состояния грида, устройств и блоков.
- Вызов всех публичных методов грида через единый инструмент.
- Доступ ко всем базовым и специализированным методам устройств.
- Получение телеметрии и метаданных устройств по запросу клиента.

## Установка

1. Установите зависимости (fastmcp и саму библиотеку `secontrol`). Находясь в
   корне репозитория:
   ```bash
   pip install -e .
   pip install fastmcp
   ```
2. Убедитесь, что переменные окружения `REDIS_USERNAME` и `REDIS_PASSWORD`
   содержат ваши учётные данные Space Engineers, либо используйте инструмент
   `authenticate_redis` и передайте их явно.

## Запуск сервера

```bash
python -m fastmcp_grid_server.server
```

По умолчанию сервер стартует в STDIO-режиме fastmcp. Его можно проксировать
через LLM-клиент, поддерживающий MCP (например, Claude Desktop или другие
инструменты, совместимые с MCP 1.0).

## Доступные инструменты

После авторизации (`authenticate_redis`) становятся доступны инструменты:

- `list_grids` — список всех гридов с возможностью добавить `gridinfo`.
- `describe_grid_methods` — сигнатуры и описания методов грида.
- `get_grid_state` — состояние конкретного грида с устройствами и блоками.
- `list_grid_devices` — устройства выбранного грида (с телеметрией по желанию).
- `describe_device_methods` — доступные методы для любого типа устройства.
- `get_device_snapshot` — телеметрия и метаданные отдельного устройства.
- `call_grid_method` — вызов любого поддерживаемого метода грида.
- `call_device_method` — вызов методов устройств (как базовых, так и
  специализированных).
- `disconnect_redis` — разрыв соединения для текущей сессии MCP.

Каждый инструмент снабжён подробным описанием и схемой аргументов в коде, что
позволяет LLM-клиентам автоматически формировать корректные запросы.

## Примечания

- Подписки на события и методы, требующие callback-функций, недоступны, так как
  их невозможно корректно реализовать в рамках MCP-интерфейса.
- Для управления разными сессиями fastmcp создаёт индивидуальные Redis
  подключения; завершайте работу инструментом `disconnect_redis`, чтобы
  освобождать ресурсы.
